webpackJsonp([10],{"8/1l":function(t,i,e){var s=e("yTRw");"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);e("rjj0")("53a97f4a",s,!0)},BtoP:function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=e("BVtZ"),n={name:"pic-tag-view",data:function(){return{lineSetting:{color:"#000",width:2},mission:{id:"",type:"",title:"",description:"",done:0,total:0},picTagObj:{authorId:0,picData:"",picId:"",mark:"",tag:"",time:0},canvasState:{startX:0,startY:0,isMouseDown:!1},operatingHistory:{history:[],version:-1,endVersion:0},doneImages:{index:-1,images:[]},startAt:0}},computed:{drawMode:function(){return{border_mark:1,frame_mark:2,comment:3,border_mc:4,frame_mc:5}[this.mission.type]},ChineseTagType:function(){return{border_mark:"边界标记",frame_mark:"方框标记",comment:"整体评注",border_mc:"边界标记+评注",frame_mc:"方框标记+评注"}[this.mission.type]},canvas:function(){return document.getElementById("myCanvas")},ctx:function(){return document.getElementById("myCanvas").getContext("2d")},styleObj:function(){return{backgroundImage:'url("'+this.picTagObj.picData+'")'}},left:function(){return this.mission.total-this.mission.done}},methods:{mouse_down:function(t){this.canvasState.isMouseDown=!0,this.canvasState.startX=t.offsetX,this.canvasState.startY=t.offsetY,this.ctx.moveTo(this.canvasState.startX,this.canvasState.startY)},mouse_up:function(){this.ctx.beginPath(),this.canvasState.isMouseDown=!1,this.addVersion()},onClearCanvas:function(){this.clearCanvas(),this.addVersion()},clearCanvas:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},fillCanvasWith:function(t){var i=new Image;i.setAttribute("crossOrigin","anonymous"),i.src=t;var e=this;i.onload=function(){e.ctx.drawImage(i,0,0,e.canvas.width,e.canvas.height)}},draw:function(t){switch(this.ctx.strokeStyle=this.lineSetting.color,this.ctx.lineWidth=this.lineSetting.width,this.drawMode){case 4:case 1:this.drawPencil(t);break;case 2:case 5:this.drawRect(t)}},drawPencil:function(t){this.canvasState.isMouseDown&&(this.ctx.lineTo(t.offsetX,t.offsetY),this.ctx.stroke())},drawRect:function(t){this.canvasState.isMouseDown&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.beginPath(),this.ctx.strokeRect(this.canvasState.startX,this.canvasState.startY,t.offsetX-this.canvasState.startX,t.offsetY-this.canvasState.startY),this.fillCanvasWith(this.operatingHistory.history[this.operatingHistory.version]))},drawCircle:function(t){if(this.canvasState.isMouseDown){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.beginPath();var i=(t.offsetX-this.canvasState.startX)/2,e=(t.offsetY-this.canvasState.startY)/2,s=Math.sqrt(i*i+e*e);this.ctx.arc(i+this.canvasState.startX,e+this.canvasState.startY,s,0,2*Math.PI),this.ctx.stroke()}},addVersion:function(){this.operatingHistory.history[++this.operatingHistory.version]=this.canvas.toDataURL(),this.operatingHistory.endVersion=this.operatingHistory.version},undo:function(){this.operatingHistory.version-1>=0&&(this.clearCanvas(),this.fillCanvasWith(this.operatingHistory.history[--this.operatingHistory.version]))},redo:function(){this.operatingHistory.version+1<=this.operatingHistory.endVersion&&(this.clearCanvas(),this.fillCanvasWith(this.operatingHistory.history[++this.operatingHistory.version]))},restartVCS:function(){this.operatingHistory.history.splice(0,this.operatingHistory.history.length),this.operatingHistory.version=-1,this.addVersion()},getNewPic:function(){var t=this,i=this;this.loadingPic=!0,Object(s.b)(this.mission.id,"tag",0).then(function(e){t.loadingPic=!1,e.data.result?(i.picTagObj=e.data.message,i.clearCanvas(),i.restartVCS(),i.oldImgAdd(i.picTagObj),i.startAt=(new Date).getTime()):i.$message({message:"获取图片失败",type:"warning"})})},oldImgAdd:function(t){this.doneImages.images.push(t),this.doneImages.index++},onNext:function(){var t=this,i=this;this.doneImages.index<=this.doneImages.images.length-2?this.updateTheAnswer().then(function(t){t.data.result?i.nextOld():i.$message({message:t.data.message,type:"danger"})}):this.postTheAnswer().then(function(e){e.data.result?(i.mission.done++,i.mission.done<i.mission.total?i.getNewPic():t.mission.done===t.mission.total&&(t.$message({message:"您已经顺利完成此任务，可在已完成列表中查看。",type:"success"}),t.$router.push({path:"/dashboard"}))):i.$message({message:e.data.message,type:"danger"})})},onLast:function(){this.preOld()||this.$message({message:"这已经是第一张图了",type:"warning"})},nextOld:function(){return this.startAt=(new Date).getTime(),this.doneImages.index<=this.doneImages.images.length-2&&(this.picTagObj=this.doneImages.images[++this.doneImages.index],this.clearCanvas(),this.fillCanvasWith(this.picTagObj.mark),this.restartVCS(),!0)},preOld:function(){return this.startAt=(new Date).getTime(),!(this.doneImages.index-1<0)&&(this.picTagObj=this.doneImages.images[--this.doneImages.index],this.clearCanvas(),this.fillCanvasWith(this.picTagObj.mark),this.restartVCS(),!0)},postTheAnswer:function(){return this.picTagObj.authorId=this.$store.state.user.id,this.picTagObj.mark=this.canvas.toDataURL(),this.picTagObj.time=(new Date).getTime()-this.startAt,Object(s.m)(this.mission.id,this.picTagObj.picId,this.picTagObj.mark,this.picTagObj.tag,this.picTagObj.time)},updateTheAnswer:function(){return this.picTagObj.authorId=this.$store.state.user.id,this.picTagObj.mark=this.canvas.toDataURL(),this.picTagObj.time+=(new Date).getTime()-this.startAt,Object(s.p)(this.mission.id,this.picTagObj.picId,this.picTagObj.mark,this.picTagObj.tag,this.picTagObj.time)}},created:function(){this.mission=this.$store.state.mission.currentMission,this.getNewPic()},mounted:function(){this.restartVCS()}},a={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{attrs:{id:"viewBox"}},[e("div",{attrs:{id:"toolbar"}},[e("el-card",{staticClass:"info"},[e("div",{attrs:{slot:"header"},slot:"header"},[t._v(t._s("任务要求： ("+t.ChineseTagType+")"))]),t._v(" "),e("div",{attrs:{id:"desc"}},[t._v(t._s(t.mission.description))])]),t._v(" "),e("div",{attrs:{id:"func-bar"}},[e("fieldset",[e("legend",[t._v("快捷工具")]),t._v(" "),e("el-button-group",{attrs:{id:"two_btn"}},[e("el-tooltip",{attrs:{effect:"dark",content:"清除所有",placement:"top"}},[e("el-button",{attrs:{id:"tools_clear",type:"info",plain:"",size:"small",icon:"el-icon-delete"},on:{click:t.onClearCanvas}})],1),t._v(" "),e("el-tooltip",{attrs:{effect:"dark",content:"撤销",placement:"top"}},[e("el-button",{attrs:{id:"tools_undo",type:"info",plain:"",size:"small",icon:"el-icon-arrow-left"},on:{click:t.undo}})],1),t._v(" "),e("el-tooltip",{attrs:{effect:"dark",content:"重做",placement:"top"}},[e("el-button",{attrs:{id:"tools_redo",type:"info",plain:"",size:"small",icon:"el-icon-arrow-right"},on:{click:t.redo}})],1)],1)],1)]),t._v(" "),e("div",{attrs:{id:"setting-bar"}},[e("fieldset",[e("legend",[t._v("线条设置")]),t._v(" "),e("span",{staticStyle:{"margin-top":"6px"}},[t._v("width: ")]),t._v(" "),e("el-select",{staticStyle:{width:"80px"},attrs:{id:"penWidth",size:"small"},model:{value:t.lineSetting.width,callback:function(i){t.$set(t.lineSetting,"width",i)},expression:"lineSetting.width"}},t._l(5,function(t){return e("el-option",{key:t,attrs:{label:t+"px",value:t}})})),t._v(" "),e("span",[t._v("Color:")]),t._v(" "),e("el-color-picker",{attrs:{size:"small"},model:{value:t.lineSetting.color,callback:function(i){t.$set(t.lineSetting,"color",i)},expression:"lineSetting.color"}})],1)]),t._v(" "),e("el-card",{staticClass:"info"},[e("div",{attrs:{slot:"header"},slot:"header"},[t._v("图片总数："+t._s(t.mission.total))]),t._v(" "),e("div",[t._v("剩余："+t._s(t.left))])])],1),t._v(" "),e("div",{staticStyle:{"margin-bottom":"12px"}},[e("el-progress",{staticStyle:{padding:"0"},attrs:{percentage:t.mission.done/t.mission.total*100,"stroke-width":4,"show-text":!1,"text-inside":""}})],1),t._v(" "),e("div",{staticStyle:{display:"flex","justify-content":"space-around"},attrs:{id:"main-content"}},[e("div",{staticClass:"arrow",staticStyle:{display:"flex","align-items":"center"}},[e("el-button",{attrs:{type:"info",plain:"",icon:"el-icon-d-arrow-left"},on:{click:t.onLast}},[e("b",[t._v("上一张")])])],1),t._v(" "),e("div",{style:t.styleObj,attrs:{id:"picture"}},[e("canvas",{attrs:{id:"myCanvas",width:"720px",height:"405px"},on:{mousedown:function(i){t.mouse_down(i)},mouseup:function(i){t.mouse_up(i)},mousemove:function(i){t.draw(i)}}})]),t._v(" "),e("div",{staticClass:"arrow",staticStyle:{display:"flex","align-items":"center"}},[e("el-button",{attrs:{type:"info",plain:"",loading:this.loadingPic},on:{click:t.onNext}},[e("b",[t._v("下一张")]),e("i",{staticClass:"el-icon-d-arrow-right el-icon--right"})])],1)]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.drawMode>2,expression:"drawMode>2"}],staticStyle:{display:"flex","justify-content":"center","margin-top":"4px"},attrs:{id:"tag"}},[e("div",{staticStyle:{width:"720px"}},[t._m(0),e("el-input",{attrs:{required:"",autofocus:"",placeholder:"请输入您对标记区域的评注"},model:{value:t.picTagObj.tag,callback:function(i){t.$set(t.picTagObj,"tag",i)},expression:"picTagObj.tag"}})],1)])])},staticRenderFns:[function(){var t=this.$createElement,i=this._self._c||t;return i("span",[i("b",[this._v("评注>>>：")])])}]};var o=e("VU/8")(n,a,!1,function(t){e("8/1l")},"data-v-fa62f782",null);i.default=o.exports},yTRw:function(t,i,e){(t.exports=e("FZ+f")(!1)).push([t.i,"\n#toolbar[data-v-fa62f782] {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: justify;\n      -ms-flex-pack: justify;\n          justify-content: space-between;\n  -webkit-box-align: baseline;\n      -ms-flex-align: baseline;\n          align-items: baseline;\n  /*margin-bottom: 12px;*/\n  /*border-bottom: gray 2px solid;*/\n  padding: 4.8px 48px;\n  background-color: #413c35;\n  color: #fff;\n  font-size: 14px;\n}\n.info[data-v-fa62f782] {\n  background-color: #1BBD9B;\n  color: #fff;\n  font-size: 14px;\n  /*padding: 4px;*/\n}\n#picture[data-v-fa62f782] {\n  background-size: 100% 100%;\n  background-repeat: no-repeat;\n  width: 726px;\n  height: 411px;\n  border: #000 dashed 3px;\n}\n\n/*.arrow-btn{*/\n\n/*!*font-size: 38px;*!*/\n\n/*!*display: inline-block;*!*/\n\n/*width: 120px;*/\n\n/*height:48px;*/\n\n/*background-color: #061F20;*/\n\n/*color:white;*/\n\n/*border: 2px solid #fff;*/\n\n/*border-radius: 4.8px;*/\n\n/*}*/\n\n/*.arrow-btn:hover{*/\n\n/*background-color: #42b983;*/\n\n/*}*/\n\n/*.choice_btn{*/\n\n/*color: white;*/\n\n/*padding: 2px;*/\n\n/*margin: 8px 0;*/\n\n/*border: none;*/\n\n/*border-radius: 4px;*/\n\n/*cursor: pointer;*/\n\n/*}*/\n#_right[data-v-fa62f782] {\n  background-color: #4CAF50;\n}\n#_right[data-v-fa62f782]:hover {\n  background-color: #45a049;\n}\n#_wrong[data-v-fa62f782] {\n  background-color: #ff2d2d;\n}\n#_wrong[data-v-fa62f782]:hover {\n  background-color: #ce0000;\n}\n\n/*input[type=text]{*/\n\n/*font-size: 25px;*/\n\n/*width: 570px;*/\n\n/*border: 1px solid #ccc;*/\n\n/*border-radius: 4px;*/\n\n/*box-sizing: border-box;*/\n\n/*padding: 2px;*/\n\n/*}*/\n",""])}});